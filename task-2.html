<!DOCTYPE HTML>
<html lang="ru">
<head>
    <title>ДЗ 2 - Web-технологии</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>
<body>
    <div class="container">

        <h1 class="text-center">Домашнее задание 2</h1>
        <h2 class="text-center">Настройка веб-серверов</h2>

        <p>Цель домашнего задания подготовить инфраструктуру для будущего проекта и научиться настраивать веб-серверы. Внимание! Вместо <b>pupkin</b> используйте <b>свою фамилию</b>.</p>

        <h3>1. Создание директории проекта ask_pupkin</h3>
        <p>С помощью утилиты django-admin (появляется после установки django) нужно создать следущую структуру:</p>
        <pre><code>
    ask_pupkin            - директория проекта
        |--- ask_pupkin   - библиотеки проекта (будут созданы django-admin.py)
        |--- manage.py    - скрипт управления (будет создан django-admin.py)
        |--- ask          - директория приложения (создается командой startproject)
        |--- templates    - шаблоны
        |--- static       - статические файлы (JS, CSS, картинки)
        |--- uploads      - файлы загруженные юзером
        </code></pre>
        <p>При этом директории templates, static, uploads — придется создать самостоятельно.</p>

        <h3>2. Настройка gunicorn для запуска WSGI скриптов</h3>

        <h3>3. Создание простой WSGI скрипт</h3>
        <p>Создать скрипт, который:</p>
        <ul>
            <li>выводит “привет, мир”</li>
            <li>выводит список переданных GET и POST параметров</li>
            <li>выполняется при запросе localhost:8081</li>
        </ul>

        <h3>4. Реализовать пункт 3 с помощью django</h3>
        <p>Для этого необходимо сделать:</p>
        <ul>
            <li>создать новую вьюшку которая выводит GET и POST параметры в <b>views.py</b></li>
            <li>подключить ее к нужному URL в <b>urls.py</b></li>
            <li>прописать WSGI скрип, созданный Django (скорее всего wsgi.py) в gunicorn.</li>
        </ul>

        <h3>5. Настройка nginx для отдачи статического контента.</h3>
        <p>Необходимо настроить nginx следующим образом. Все файлы с URL начинающимся с <b>/uploads/</b> отдаются из <b>ask_pupkin/uploads</b>. Все файлы с расширением (.js .css .jpeg и т.д) — из директории <b>ask_pupkin/static</b>. Файлы должны отдаваться c заголовками, кеширующими файлы на стороне браузера. Файлы должны сжиматься на сервере для уменьшения размера передаваемых файлов. Размер конфига nginx не должен превышать 50 строк. Полученную конфигурацию необходимо запустить и проверить, для этого нужно разместить какой-либо файл (например <b>sample.html</b>) в директории <b>static</b> и загрузить его с помощью браузера <b>localhost/sample.html</b>.</p>

        <h3>6. Настройка проксирования в nginx</h3>
        <ul>
            <li>Настроить nginx для проксирования всех нестатических запросов (URL без расширения, например <b>/</b> или <b>/login/</b>) на gunicorn.</li>
            <li>Настроить <b>upstream</b>.</li>
            <li>Настроить <b>proxy_cache</b> и проверить его работу.</li>
        </ul>

        <h3>7. Сравнение производительности.</h3>
        <p>С помощью утилиты Apache Benchmark (ab, идет в комплекте с Apache, для Ubuntu пакет <b>apache2-utils</b>) сравните производительность nginx (отдача статики) и gunicorn (запуск wsgi скриптов).</p>
        <ul>
            <li>Насколько быстрее отдается статика по сравнению с WSGI?</li>
            <li>Во сколько раз ускоряет работу proxy_cache?</li>
        </ul>

        <h3>8. Результат выполнения домашнего задания</h3>
        <p>Результат выполнения домашнего задания является:</p>
        <ul>
            <li>директория с созданным проектом</li>
            <li>конфиг nginx</li>
            <li>конфиг gunicorn</li>
            <li>результаты нагрузочного тестирования (вывод утилиты ab) для nginx и gunicorn</li>
        </ul>
        <p>Проект нужно положить в систему контроля версии <a target="_blank" href="bitbucket.com">bitbucket.com</a> или <a target="_blank" href="github.com и">github.com</a> и выслать ссылку своему семинаристу письмом с пометкой <b>[TP]</b> в теме. Пометка именно такая, английскими буквами и обязательна.</p>

        <h3>9. Полезные ссылки.</h3>
        <ul>
            <li><a target="_blank" href="http://nginx.org/ru/docs/">Nginx</a></li>
            <li><a target="_blank" href="http://nginx.org/ru/docs/http/ngx_http_proxy_module.html#example">О проксирования в nginx</a></li>
            <li><a target="_blank" href="http://docs.gunicorn.org/en/latest/configure.html">Gunicorn</a></li>
        </ul>
    </div>
</body>
</html>
